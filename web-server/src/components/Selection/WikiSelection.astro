---
import clsx from "clsx";
import { get_supported_wikis } from "../../db/constants";
import { InfoIcon } from "../ClientIcons/Icons";
import { TooltipButton } from "../TooltipButton";
import Selection, { type SelectionProps } from "./Selection.astro";

interface Props extends SelectionProps {
    currrent_wikiname?: string | undefined;
    global_possible?: boolean;
    dump_date?: string;
    wikis_shown?: string[];
    noscript?: boolean;
    dir?: string;
}

const {
    currrent_wikiname,
    dir,
    global_possible,
    dump_date,
    noscript,
    wikis_shown,
    ...rest
} = Astro.props;
const wikis = wikis_shown ?? await get_supported_wikis(dump_date || "latest");
---

<Selection
    currrent_item={currrent_wikiname}
    items={wikis}
    what="Wikis"
    {...rest}
    get_url={(item) =>
        ["/wiki", item, noscript ? "noscript" : "", dir]
            .filter(Boolean)
            .join("/")}>
    <div slot="legend" class="inline-block">
        <TooltipButton
            client:load
            tooltip="Available wikipedias for the selected dump date">
            <span class="inline-flex items-center gap-1 font-bold">
                <span class="inline-block w-4">
                    <InfoIcon />
                </span>
            </span>
        </TooltipButton>
    </div>

    {
        global_possible && (
            <a
                slot="global"
                href={`/wiki/${dir}`}
                class={clsx(
                    currrent_wikiname === undefined
                        ? "font-bold"
                        : "font-normal",
                    "text-center-a",
                )}>
                GLOBAL
            </a>
        )
    }
</Selection>
